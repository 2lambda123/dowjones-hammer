{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Hammer Realtime Alerting Cloudwatch Cloudformation Stack",
    "Parameters": {
        "ResourcesPrefix": {
            "Type": "String",
            "MinLength": "3",
            "Default": "hammer-"
        },
        "MasterAccountID": {
            "Type": "String",
            "MinLength": "12"
        },
        "IdentificationCrossAccountIAMRole": {
            "Type": "String",
            "Default": "cloudsec-crossact-id"
        }
    },
    "Resources": {
        "CloudWatchEventRealtimeScanner": {
            "Type": "AWS::Events::Rule",
            "Properties": {
                "Description": "Cloud Watch Event to filter for Hammer specific Events in all Accounts",
                "Name": "Cloudsec-Hammer-Realtime-Monitoring-CloudWatch-Event",
                "State": "ENABLED",
                "Targets": [
                    {
                        "Arn": {"Fn::Join":["", ["arn:aws:events:", {"Ref":"AWS::Region"}, ":", {"Ref":"MasterAccountID"}, ":event-bus/default"]]},
                        "Id": "default",
                        "RoleArn": {"Fn::Join":["", ["arn:aws:iam::", {"Ref":"AWS::AccountId"}, ":role/", { "Ref": "ResourcesPrefix" }, "realtime-eventbus-forwarding-role"]]}
                    }
                ],
                "EventPattern": {
                    "detail-type": [
                        "AWS API Call via CloudTrail"
                    ],
                    "detail": {
                        "eventName": [
                            "CreateSecurityGroup",
                            "DeleteSecurityGroup",
                            "UpdateSecurityGroupRuleDescriptionsEgress",
                            "AuthorizeSecurityGroupEgress",
                            "AuthorizeSecurityGroupIngress",
                            "RevokeSecurityGroupEgress",
                            "RevokeSecurityGroupIngress",
                            "UpdateSecurityGroupRuleDescriptionsIngress",
                            "CopySnapshot",
                            "CreateSnapshot",
                            "CreateSnapshots",
                            "DeleteSnapshot",
                            "ModifySnapshotAttribute",
                            "ResetSnapshotAttribute",
                            "DisableEbsEncryptionByDefault",
                            "EnableEbsEncryptionByDefault",
                            "ModifyEbsDefaultKmsKeyId",
                            "ResetEbsDefaultKmsKeyId",
                            "AttachVolume",
                            "CreateVolume",
                            "DeleteVolume",
                            "DetachVolume",
                            "ModifyVolume",
                            "ModifyVolumeAttribute",
                            "AddRoleToInstanceProfile",
                            "AddUserToGroup",
                            "AttachGroupPolicy",
                            "AttachRolePolicy",
                            "AttachUserPolicy",
                            "ChangePassword",
                            "CreateAccessKey",
                            "CreateUser",
                            "CreateVirtualMFADevice",
                            "CreatePolicy",
                            "CreateRole",
                            "DeactivateMFADevice",
                            "DeleteAccessKey",
                            "DeleteAccountPasswordPolicy",
                            "DeleteGroup",
                            "DeleteGroupPolicy",
                            "DeleteLoginProfile",
                            "DeletePolicy",
                            "DeleteRole",
                            "DeleteRolePolicy",
                            "DeleteUser",
                            "DeleteUserPolicy",
                            "DeleteVirtualMFADevice",
                            "DetachGroupPolicy",
                            "DetachRolePolicy",
                            "DetachUserPolicy",
                            "user_withpassword",
                            "PutGroupPolicy",
                            "PutRolePolicy",
                            "PutUserPolicy",
                            "ResyncMFADevice",
                            "UpdateAccessKey",
                            "UpdateAccountPasswordPolicy",
                            "UpdateAssumeRolePolicy",
                            "UpdateGroup",
                            "UpdateLoginProfile",
                            "UpdateUser",
                            "CreateBucket",
                            "DeleteBucket",
                            "DeleteBucketPolicy",
                            "DeleteBucketTagging",
                            "PutBucketAcl",
                            "PutBucketPolicy",
                            "PutBucketReplication",
                            "PutBucketTagging",
                            "DeleteBucketEncryption",
                            "DeletePublicAccessBlock",
                            "PutBucketEncryption",
                            "PutPublicAccessBlock",
                            "AddPermission",
                            "CreateQueue",
                            "SetQueueAttributes",
                            "RemovePermission",
                            "DeleteQueue",
                            "CopyDBSnapshot",
                            "CreateDBInstance",
                            "CreateDBSnapshot",
                            "DeleteDBInstance",
                            "DeleteDBSnapshot",
                            "ModifyDBInstance",
                            "ModifyDBSnapshot",
                            "RestoreDBInstanceFromDBSnapshot",
                            "RestoreDBInstanceFromS3",
                            "RestoreDBInstanceToPointInTime",
                            "StartDBInstance",
                            "StopDBInstance"
                        ]
                    }
                }
            }
        }
    }
}